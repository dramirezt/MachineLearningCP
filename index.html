<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Machine Learning Course Project by dramirezt</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Machine Learning Course Project</h1>
        <h2>Machine Learning Course Project</h2>

        <section id="downloads">
          <a href="https://github.com/dramirezt/MachineLearningCP/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/dramirezt/MachineLearningCP/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/dramirezt/MachineLearningCP" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <hr>

<p>title: "Machine Learning - Course Project"
author: "Daniel Ram√≠rez Torres"
date: "22/08/2015"</p>

<h2>
<a id="output-html_document" class="anchor" href="#output-html_document" aria-hidden="true"><span class="octicon octicon-link"></span></a>output: html_document</h2>

<h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>In this project, we will use the information obtained from several accelerometers of 6 participants. The participants were asked to perform barebell lifts correctly an dincorrectly in 5 different ways. The goal of this project is to predict the manner in which they did the exercise. This is the "classe" variable in the training set.</p>

<p>In the end, the question to answer is: can we predict the quality of the activity?</p>

<h2>
<a id="loading-and-exploring-the-data" class="anchor" href="#loading-and-exploring-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loading and exploring the data</h2>

<p>First we need to download our training and test sets, as well as load the caret package which will be used later.</p>

<p>Training set download: 
<a href="https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv">https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv</a></p>

<p>Test set download: 
<a href="https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv">https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv</a></p>

<div class="highlight highlight-r"><pre>library(<span class="pl-smi">caret</span>)
<span class="pl-smi">dtrain</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>pml-training.csv<span class="pl-pds">"</span></span>)
<span class="pl-smi">dtest</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>pml-testing.csv<span class="pl-pds">"</span></span>)</pre></div>

<p>As we want to build a predictor, we'll decompose our training set into two datasets (one for testing and the other to use as supervised training)</p>

<div class="highlight highlight-r"><pre>set.seed(<span class="pl-c1">1234</span>)
<span class="pl-smi">split</span> <span class="pl-k">&lt;-</span> createDataPartition(<span class="pl-v">y</span><span class="pl-k">=</span><span class="pl-smi">dtrain</span><span class="pl-k">$</span><span class="pl-smi">classe</span>, <span class="pl-v">p</span><span class="pl-k">=</span><span class="pl-c1">0.8</span>, <span class="pl-v">list</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>)
<span class="pl-smi">training</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">dtrain</span>[<span class="pl-smi">split</span>, ]
<span class="pl-smi">testing</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">dtrain</span>[<span class="pl-k">-</span><span class="pl-smi">split</span>, ]
ncol(<span class="pl-smi">training</span>)</pre></div>

<p>As we can see, we have a lot of features in our dataset. In the next section we will analyze them and clean the dataset in order to use only the relevant features.</p>

<p>The data for this project come from this source: <a href="http://groupware.les.inf.puc-rio.br/har">http://groupware.les.inf.puc-rio.br/har</a>.</p>

<h2>
<a id="cleaning-the-dataset" class="anchor" href="#cleaning-the-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cleaning the dataset</h2>

<p>As we want to reduce the number of features (in both training and testing), we'll do it by removing variables with:</p>

<ul>
<li>No intuitive sense in this prediciton.</li>
<li>Zero variance (or almost zero).</li>
<li>Most common value NA.</li>
</ul>

<div class="highlight highlight-r"><pre><span class="pl-c"># Removing the first 5 columns: X, user_name, raw_timestamp_part_1, raw_timestamp_part_2, cvtd_timestamp) as they dont make sense for prediction.</span>
<span class="pl-smi">training</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training</span>[, <span class="pl-k">-</span>(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">5</span>)]
<span class="pl-smi">testing</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">testing</span>[, <span class="pl-k">-</span>(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">5</span>)]

<span class="pl-c"># Removing zero variance values</span>
<span class="pl-smi">indexZero</span> <span class="pl-k">&lt;-</span> nearZeroVar(<span class="pl-smi">testing</span>)
<span class="pl-smi">training</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training</span>[, <span class="pl-k">-</span><span class="pl-smi">indexZero</span>]
<span class="pl-smi">testing</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">testing</span>[, <span class="pl-k">-</span><span class="pl-smi">indexZero</span>]

<span class="pl-c"># Removing variables with NA as most common value.</span>
<span class="pl-smi">indexNA</span> <span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">training</span>, <span class="pl-k">function</span>(<span class="pl-smi">x</span>) mean(is.na(<span class="pl-smi">x</span>))) <span class="pl-k">&gt;</span> <span class="pl-c1">0.9</span>
<span class="pl-smi">training</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training</span>[, <span class="pl-smi">indexNA</span><span class="pl-k">==</span><span class="pl-c1">FALSE</span>]
<span class="pl-smi">testing</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">testing</span>[, <span class="pl-smi">indexNA</span><span class="pl-k">==</span><span class="pl-c1">FALSE</span>]
ncol(<span class="pl-smi">training</span>)</pre></div>

<h2>
<a id="modeling-with-random-forests" class="anchor" href="#modeling-with-random-forests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Modeling with Random Forests</h2>

<p>As I have some experience with random forests, I have decided to create my model using them. I expect a high accuracy althoug not really good performance (as random forest is quite expensive). Let's build the model:</p>

<div class="highlight highlight-r"><pre>library(<span class="pl-smi">randomForest</span>)
<span class="pl-smi">model</span> <span class="pl-k">&lt;-</span> randomForest(<span class="pl-smi">classe</span> <span class="pl-k">~</span>. , <span class="pl-v">data</span><span class="pl-k">=</span><span class="pl-smi">training</span>)
<span class="pl-smi">model</span></pre></div>

<p>Now we can predict our in-sample error using the predict function:</p>

<div class="highlight highlight-r"><pre><span class="pl-smi">predictions</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">model</span>, <span class="pl-smi">testing</span>, <span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>class<span class="pl-pds">"</span></span>)</pre></div>

<p>Finally, we can test our results using a confusion matrix:</p>

<div class="highlight highlight-r"><pre>confusionMatrix(<span class="pl-smi">predictions</span>, <span class="pl-smi">testing</span><span class="pl-k">$</span><span class="pl-smi">classe</span>)</pre></div>

<p>As our accuracy is 99.8%, our predicted accuracy for the out-of-sample error is 0.2%.</p>

<h2>
<a id="generating-testfiles" class="anchor" href="#generating-testfiles" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generating testfiles</h2>

<div class="highlight highlight-r"><pre><span class="pl-smi">output</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">model</span>, <span class="pl-smi">dtest</span>, <span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>class<span class="pl-pds">"</span></span>)
<span class="pl-v">pml_write_files</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>){
  <span class="pl-v">n</span> <span class="pl-k">=</span> length(<span class="pl-smi">x</span>)
  <span class="pl-k">for</span>(<span class="pl-smi">i</span> <span class="pl-k">in</span> <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-smi">n</span>){
    <span class="pl-v">filename</span> <span class="pl-k">=</span> paste0(<span class="pl-s"><span class="pl-pds">"</span>problem_id_<span class="pl-pds">"</span></span>,<span class="pl-smi">i</span>,<span class="pl-s"><span class="pl-pds">"</span>.txt<span class="pl-pds">"</span></span>)
    write.table(<span class="pl-smi">x</span>[<span class="pl-smi">i</span>],<span class="pl-v">file</span><span class="pl-k">=</span><span class="pl-smi">filename</span>,<span class="pl-v">quote</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>,<span class="pl-v">row.names</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>,<span class="pl-v">col.names</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>)
  }
}
pml_write_files(<span class="pl-smi">output</span>)</pre></div>
      </section>
    </div>

    
  </body>
</html>
